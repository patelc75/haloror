<% 
require "digest" 
%>
  <%=render :partial => 'nav'%>

<div id="date_range" class="date_range">
  <% if !flash[:warning].blank? -%>
  <b><%= flash[:warning] %></b>
  <% end -%>
  <form action="/reporting/fall_panic_report">
  <table>
    <tr><td>All times are in UTC timezone</td></tr>
    <tr><td>Begin Time</td>&nbsp;&nbsp;<td>End Time</td></tr>
    <tr>
      <td><%= calendar_date_select_tag "begin_time", @begin_time, :time => true, :popup => 'force' %></td>
      <td><%= calendar_date_select_tag "end_time", @end_time, :time => true, :popup => 'force' %></td>
    </tr>
  </table>
  <%= submit_tag "Submit" %>
  </form>
  <%if @falls%>
  	<table border="1">
  		<tr>
  			<th>Start</th>
  			<th>End</th>
  			<th>New Installs</th>
  			<th>Real Falls</th>
  			<th>False Positive Falls</th>
  			<th>Falls Specificity</th>
  			<th>Real Panics</th>
  			<th>Falls Positive Panics</th>
  			<th>Panic Specificity</th>
  		</tr>
  	    <tr>
  	    	<td><%= @begin_time%></td>
  	    	<td><%= @end_time%></td>
  	    	<td><%= @installs.length%>
  	    		<% users = ""%>
  	    		<%@installs.each do |install|%>
  	    		<% users += install.user_id.to_s + "," %>
  	    		<%end%>
  	    		(<%= users.chop %>)
  	    	</td>
  	    	<td><%= @real_falls.length %></td>
  	    	<td><%= @false_positive_falls.length %></td>
  	    	<td><% falls_specify = (@real_falls.length.to_f / (@false_positive_falls.length.to_f + @real_falls.length.to_f)) if @real_falls.length != 0%>
  	    		<%= (falls_specify * 100) if falls_specify %>%
  	    	</td>
  	    	<td><%= @real_panics.length%></td>
  	    	<td><%= @false_positive_panic.length %></td>
  	    	<td><% panic_specify = ((@real_panics.length.to_f + @non_emerg_panic.length.to_f) / ( @false_positive_panic.length.to_f + @real_panics.length.to_f + @non_emerg_panic.length.to_f)) if @real_panics.length != 0%>
  	    		<%#= @non_emerg_panic.length%>
  	    		<%= (panic_specify * 100).round(1) if panic_specify%>%
   			</td>
  	    </tr>
  	</table>
  <%end%>
</div>
