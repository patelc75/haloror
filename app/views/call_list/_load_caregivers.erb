<ul id="call_list">

<% position = 1 %>
<% i = 1 %>

<% 
	user = @user
	caregivers.each do |position, caregiver|
		
		roles_user = user.roles_user_by_caregiver(caregiver)		
%>
		<% if opts = roles_user.roles_users_option %>
			<%= render :partial => "call_list/item", :locals => { :user => user, :caregiver => caregiver, :opts => opts, :position => position , :i => i, :role => caregiver } %>			
		<% end %>

	<% 
		if roles_user.roles_users_option.active
			position = position+1 
		end
	%>
	<% i = i+1 %>
<% end %>

</ul>
<script type="text/javascript">
//<![CDATA[
Sortable.create("call_list", {onChange:updatePositions, onUpdate:function(){new Ajax.Request('/call_list/sort/?user_id='+<%=params[:id]%>, {asynchronous:true, evalScripts:true, parameters:serialize()});showTooltip=false}, tag:'li'})
//]]>
</script>