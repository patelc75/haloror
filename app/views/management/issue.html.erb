<%=render :partial=>'nav'%>

<h1>Issue Commands</h1>
<br>
<% remote_form_for :management_cmd_device, :url => {:action => 'create_many'}, :update => 'issue_cmd' do |f|%>
	<p>
		<%=f.radio_button :cmd_type, 'info'%> Info Request
	</p>
	<p>
		<%=f.radio_button :cmd_type, 'reset'%> Reset
	</p>
	<p>
		<%=f.radio_button :cmd_type, 'firmware_upgrade'%> Firmware Upgrade <%=render :partial => 'firmware_upgrade'%>
	</p>
	<p>
		<%=f.radio_button :cmd_type, 'self_test'%> Self Test
	</p>
	<p>
		<%=f.radio_button :cmd_type, 'self_test_phone'%> Self Test Phone
	</p>
	<p>
		<%=f.radio_button :cmd_type, 'range_test_start'%> Range Test Start
	</p>
	<p>
		<%=f.radio_button :cmd_type, 'range_test_stop'%> Range Test Stop
	</p>
	<p>
		<%=f.radio_button :cmd_type, 'mgmt_poll_rate'%> Adjust Mgmt Poll Rate in seconds (eg. 60) <%= f.text_field :param1 %>
	</p>
	<p>
		<%=f.radio_button :cmd_type, 'dial_up_num_glob_prim'%>Change All Dial Up Numbers (<%= link_to 'configure',dial_ups_path %>)<br>
		<div style="margin-left:20px;">
		<table>
		<tr>
		  <td>Primary</td>
		  <td><%=f.select(:local_primary,DialUp.find(:all,:conditions => "dialup_type = 'Local'").map {|u| [u.phone_number,u.phone_number]},:prompt => 'none')%></td>
		  <td></td>
		</tr>
		<tr>
		  <td>Secondary</td>
		  <td><%=f.select(:local_secondary,DialUp.find(:all,:conditions => "dialup_type = 'Local'").map {|u| [u.phone_number,u.phone_number]},:prompt => 'none')%></td>
		  <td></td>
		</tr>
		<tr>
		  <td>Global Primary</td>
		  <% @glob_prim = DialUp.find(:first,:conditions => "dialup_type ='Global' and order_number = '1'") %>
		  <td><%=f.select(:global_primary,DialUp.find(:all,:conditions => "dialup_type = 'Global'").map {|u| [u.phone_number,u.phone_number]},:prompt => 'none')%></td>
		  <% if !@glob_prim.nil? %>
		  <input type="hidden" id="global_prim_hidden" value="<%= @glob_prim.phone_number %>">
		  <td><%= check_box_tag "global_default",{},checked = false,:onclick => "set_default_number(this,'global_prim_hidden','management_cmd_device_global_primary')"%> Default (<%= link_to 'Dial Up Table',dial_ups_path %>: Default Order = 2)</td>		
		  <% end %>
		</tr>
		<tr>
		  <td>Global Secondary</td>
		  <% @global_alt = DialUp.find(:first,:conditions => "dialup_type = 'Global' and order_number = '2'") %>
		  <td><%=f.select(:global_secondary,DialUp.find(:all,:conditions => "dialup_type = 'Global'").map {|u| [u.phone_number,u.phone_number]},:prompt => 'none')%></td>		  
		  <% if !@global_alt.nil? %>
		  <input type="hidden" id="global_alt_hidden" value="<%= @global_alt.phone_number %>">
		  <td><%= check_box_tag "global_alt_default",{},checked = false,{:onclick => "set_default_number(this,'global_alt_hidden','management_cmd_device_global_secondary')"}%> Default (<%= link_to 'Dial Up Table',dial_ups_path %>: Default Order = 2)</td>	
		  <% end %>
		</tr>
		</table>
		</div>
	</p>

	<p>
		<%=f.radio_button :cmd_type, 'dial_up_num'%>Change only Local Primary dial up number (backward compatible cmd)<br>
		<div style="margin-left:20px;">
		<table>
		<tr><td>Number</td><td> : </td><td><%= f.text_field :param2 %></td><td> (eg. 8005551212)</td></tr>
		<tr><td>Username</td><td>: </td><td><%= f.text_field :param3%></td><td>&nbsp;</td></tr>
		<tr><td>Password</td><td>: </td><td><%= f.text_field :param4 %></td><td>&nbsp;</td></tr>
		</table>
		</div>
	</p>
	<p>
		<%=f.radio_button :cmd_type, 'unregister'%> Unregister
	</p>
	<p>
		<%=f.radio_button :cmd_type, 'boot_image'%> Instruct cheststrap to switchover to a newly downloaded image
	</p>
    <p>
		<%=f.radio_button :cmd_type, 'remote_access',:disabled => 'disabled'%> Remote Access
	</p>
	<p>&nbsp;</p>
	<p>Enter a range of device ids (min-max) -or- ids separated by commas:</p>
	<%=f.text_field 'ids'%>
	<p>&nbsp;</p>
	<%=f.submit 'Queue up Command'%>&nbsp;&nbsp;<%= f.check_box :instantaneous ,:disabled => 'disabled'%>Instantaneous
<% end %>

<div id="issue_cmd">
	
</div>
<br/>
<br/>
<%= render :partial => 'firmware_upgrades_table' %>
<br>
<br>
<%= render :partial => 'ftp_table' %>
<script>
function set_default_number(checkbox,default_textbox,dropdown)
{
	if(checkbox.checked)
	  document.getElementById(dropdown).value = document.getElementById(default_textbox).value
	else
	  document.getElementById(dropdown).value = ''
}
</script>